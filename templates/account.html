{% extends "base.html" %}
{% block content %}
<h1>Account</h1>
<p class="muted">{{ user.email }} • {{ tier_label }}</p>

<div class="card">
  <h3>Session Timezone (DST-safe)</h3>
  <form method="post" action="/account/session-timezone" class="row">
    <input name="tz" value="{{ user.session_tz }}" placeholder="America/Chicago" />
    <button class="btn primary" type="submit">Save</button>
  </form>
  <p class="muted">Examples: America/Chicago, America/New_York, Europe/London</p>
</div>

<div class="card">
  <h3>Billing</h3>
  <p class="muted">Upgrade via Stripe Checkout or manage your subscription:</p>

  <div class="row" style="gap:10px; flex-wrap:wrap;">
    <button class="btn primary" onclick="startCheckout('tactical')">Upgrade Tactical</button>
    <button class="btn primary" onclick="startCheckout('elite')">Upgrade Elite</button>
    <a class="btn" href="/billing/portal">Manage Billing</a>
    <a class="btn" href="/suite" style="margin-left:auto;">Back to Suite</a>
  </div>

  <div id="billStatus" class="muted" style="margin-top:10px;"></div>
</div>

<script>
async function startCheckout(tier){
  const s = document.getElementById("billStatus");
  s.textContent = "Opening Stripe Checkout…";
  try{
    const res = await fetch("/billing/checkout", {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      credentials: "same-origin",
      body: JSON.stringify({tier})
    });
    const data = await res.json();
    if(!res.ok) throw new Error(data.detail || "Checkout failed");
    window.location = data.url;
  }catch(e){
    s.textContent = "Billing error: " + e.message;
  }
}
</script>
{% endblock %}
