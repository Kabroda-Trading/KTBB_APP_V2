<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>PROJECT OMEGA // COMMAND</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700;800&family=Inter:wght@400;600;900&display=swap" rel="stylesheet">
    <style>
        :root { 
            --bg: #020617; --panel: #0f172a; --border: #1e293b; 
            --green: #10b981; --red: #ef4444; --amber: #f59e0b; --text-main: #ffffff; --text-dim: #94a3b8; 
            --sonic-color: #06b6d4; --sonic-glow: rgba(6, 182, 212, 0.2);
            --sniper-color: #10b981; --sniper-glow: rgba(16, 185, 129, 0.2);
            --dog-color: #f59e0b; --dog-glow: rgba(245, 158, 11, 0.2);
        }
        body { background: var(--bg); color: var(--text-main); font-family: 'Inter', sans-serif; margin: 0; padding: 20px; box-sizing: border-box; }
        
        /* UTILITIES */
        .top-nav { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); padding-bottom: 20px; margin-bottom: 25px; flex-wrap: wrap; gap:10px; }
        .brand { font-family: 'JetBrains Mono'; font-weight: 800; font-size: 24px; display: flex; align-items: center; gap: 12px; }
        .blink { animation: blinker 2s linear infinite; width: 12px; height: 12px; background: var(--green); border-radius: 50%; box-shadow: 0 0 10px var(--green); }
        @keyframes blinker { 50% { opacity: 0.3; } }

        /* LAYOUT */
        .war-room { display: grid; grid-template-columns: 340px 1fr 340px; gap: 25px; }
        @media (max-width: 1100px) { .war-room { grid-template-columns: 1fr; } }

        .panel { background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 25px; display: flex; flex-direction: column; }
        .panel-head { font-family: 'JetBrains Mono'; font-size: 14px; font-weight: 800; letter-spacing: 1px; margin-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 15px; display:flex; justify-content:space-between; }

        /* INPUTS */
        .input-group { margin-bottom: 15px; }
        .input-label { display: flex; justify-content: space-between; font-size: 11px; color: var(--text-dim); margin-bottom: 6px; font-family: 'JetBrains Mono'; font-weight: 600; }
        .input-field { width: 100%; background: #020617; border: 1px solid var(--border); color: #fff; padding: 12px; font-family: 'JetBrains Mono'; font-size: 15px; text-align: right; box-sizing: border-box; outline: none; border-radius: 6px; }
        .copy-btn { background: #1e293b; border: none; color: #fff; border-radius: 4px; padding: 5px 10px; font-size: 10px; font-weight: 700; cursor: pointer; font-family: 'JetBrains Mono'; margin-left: 10px; }
        .copy-btn:hover { background: #334155; }

        /* CENTER DISPLAY */
        .price-display { text-align: center; margin-bottom: 30px; }
        .live-price { font-size: 80px; font-weight: 900; letter-spacing: -3px; line-height: 1; color: #fff; text-shadow: 0 0 40px rgba(255,255,255,0.1); }
        
        .theme-card { padding: 30px; border-radius: 8px; text-align: center; border: 2px solid #333; background: #020617; transition: 0.3s; margin-bottom: 30px; position: relative; overflow: hidden; }
        .theme-lbl { font-size: 11px; letter-spacing: 3px; text-transform: uppercase; margin-bottom: 12px; font-weight: 700; }
        .theme-val { font-size: 32px; font-weight: 900; font-family: 'JetBrains Mono'; line-height: 1.1; color: #fff; }
        
        /* THEMES */
        .mode-sonic { border-color: var(--sonic-color); box-shadow: 0 0 40px var(--sonic-glow); }
        .mode-sonic .theme-lbl { color: var(--sonic-color); }
        .mode-sonic::before { content: "⚡ SUPERSONIC"; position: absolute; top: 10px; right: 10px; font-size: 10px; color: var(--sonic-color); font-family: 'JetBrains Mono'; font-weight: 800; border: 1px solid var(--sonic-color); padding: 2px 6px; border-radius: 4px; }

        .mode-sniper { border-color: var(--sniper-color); box-shadow: 0 0 40px var(--sniper-glow); background: radial-gradient(circle at center, rgba(16, 185, 129, 0.05) 0%, #020617 70%); }
        .mode-sniper .theme-lbl { color: var(--sniper-color); }
        .mode-sniper::before { content: "⌖ SNIPER"; position: absolute; top: 10px; right: 10px; font-size: 10px; color: var(--sniper-color); font-family: 'JetBrains Mono'; font-weight: 800; border: 1px solid var(--sniper-color); padding: 2px 6px; border-radius: 4px; }

        .mode-dogfight { border-color: var(--dog-color); box-shadow: 0 0 40px var(--dog-glow); }
        .mode-dogfight .theme-lbl { color: var(--dog-color); }
        .mode-dogfight::before { content: "⚠ DOGFIGHT"; position: absolute; top: 10px; right: 10px; font-size: 10px; color: var(--dog-color); font-family: 'JetBrains Mono'; font-weight: 800; border: 1px solid var(--dog-color); padding: 2px 6px; border-radius: 4px; }

        /* EXECUTION OVERRIDE */
        .exec-active { border-color: #fff !important; box-shadow: 0 0 50px rgba(255,255,255,0.3) !important; background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(2,6,23,1) 70%) !important; }
        .exec-active .theme-lbl { color: #fff !important; animation: pulse 1s infinite; }
        .exec-active .theme-val { color: #fff !important; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        /* TARGET GRID */
        .target-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; text-align: center; }
        .target-box { background: #020617; padding: 15px 10px; border-radius: 6px; border: 1px solid var(--border); }
        .target-lbl { font-size: 10px; margin-bottom: 6px; letter-spacing:1px; font-weight: 700; text-transform: uppercase; color: var(--text-dim); }
        .target-val { font-family: 'JetBrains Mono'; font-weight: 700; font-size: 14px; color: #fff; }

        /* TOGGLES */
        .tactical-toggle { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; }
        .side-btn { background: #020617; border: 1px solid var(--border); color: var(--text-dim); padding: 8px 20px; border-radius: 4px; font-family: 'JetBrains Mono'; font-size: 12px; cursor: pointer; font-weight: 700; text-transform: uppercase; }
        .side-btn:hover { border-color: #fff; color: #fff; }
        .side-btn.active-long { background: rgba(16, 185, 129, 0.1); border-color: var(--green); color: var(--green); }
        .side-btn.active-short { background: rgba(239, 68, 68, 0.1); border-color: var(--red); color: var(--red); }

        .cyber-select { background: #020617; color: #fff; border: 1px solid var(--border); padding: 8px 12px; border-radius: 4px; font-family: 'JetBrains Mono'; font-size: 11px; text-transform: uppercase; outline: none; cursor: pointer; height: 34px; }
        .toggle-btn { background: transparent; border: 1px solid var(--text-dim); color: var(--text-dim); padding: 0 14px; height: 34px; font-family: 'JetBrains Mono'; font-size: 11px; cursor: pointer; border-radius: 4px; transition: 0.2s; font-weight: 700; text-transform: uppercase; }
        .toggle-btn.active { background: var(--red); color: #fff; border-color: var(--red); } /* FERRARI RED */
        
        .data-row { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 13px; border-bottom: 1px dashed rgba(255,255,255,0.05); padding-bottom: 5px; }

        .kinetic-bar { margin-top: 20px; padding: 15px; background: #0f172a; border: 1px solid var(--border); border-radius: 8px; display: flex; align-items: center; justify-content: space-between; }
        .k-score { font-family: 'JetBrains Mono'; font-size: 24px; font-weight: 800; color: #fff; }
        .k-mode { font-size: 11px; font-weight: 700; padding: 4px 8px; border-radius: 4px; text-transform: uppercase; letter-spacing: 1px; }
        .k-ferrari { background: rgba(6, 182, 212, 0.15); color: var(--sonic-color); border: 1px solid var(--sonic-color); }
        .k-sniper { background: rgba(16, 185, 129, 0.15); color: var(--sniper-color); border: 1px solid var(--sniper-color); }
        .k-dogfight { background: rgba(245, 158, 11, 0.15); color: var(--dog-color); border: 1px solid var(--dog-color); }
        
        .brief-box { margin-top: 15px; padding: 12px; background: rgba(255,255,255,0.03); border-radius: 6px; border-left: 3px solid var(--text-dim); }
        .brief-text { font-size: 13px; color: #cbd5e1; font-style: italic; line-height: 1.4; }
    </style>
</head>
<body>

    <div class="top-nav">
        <div class="brand"><div class="blink"></div>PROJECT OMEGA</div>
        <div style="display:flex; gap:10px;">
            <select id="sessionSelect" class="cyber-select" onchange="fetchLiveData()">
                <option value="asia_tokyo">TOKYO (ACTIVE)</option>
                <option value="us_ny_futures">NY FUTURES</option>
                <option value="eu_london">LONDON</option>
            </select>
            <button id="btnFerrari" class="toggle-btn" onclick="toggleFerrari()">FERRARI: OFF</button>
            <a href="/suite" class="toggle-btn" style="display:flex; align-items:center; text-decoration:none;">EXIT</a>
        </div>
    </div>

    <div class="war-room">
        <div class="panel">
            <div class="panel-head">POSITION COMMAND</div>
            <div class="input-group">
                <label class="input-label">BALANCE ($)</label>
                <input type="number" id="inpBal" class="input-field" value="1200" oninput="renderDisplay()">
            </div>
            <div class="input-group">
                <label class="input-label">RISK %</label>
                <input type="number" id="inpRisk" class="input-field" value="1.0" step="0.1" oninput="renderDisplay()">
            </div>
            <div style="text-align:right; font-size:12px; color:var(--red); font-weight:700; margin-bottom:20px;">
                RISK: <span id="valRiskAmt">--</span>
            </div>
            <div style="margin-top:10px; padding:15px; background:#020617; border:1px solid var(--border); border-radius:6px;">
                <div class="input-label" style="display:flex; align-items:center; justify-content:space-between;">
                    <span>EXECUTION SIZE (USDT)</span>
                    <button class="copy-btn" onclick="copySize()">COPY</button>
                </div>
                <div id="outSize" style="font-size:24px; font-family:'JetBrains Mono'; font-weight:800; color:#fff; margin-top:5px;">--</div>
            </div>
        </div>

        <div class="panel">
            <div class="panel-head">TACTICAL DISPLAY <span id="sessState" style="color:var(--green)">ACTIVE</span></div>
            <div class="price-display">
                <div class="live-price" id="livePrice">--</div>
                <div style="font-family:'JetBrains Mono'; font-size:12px; color:var(--text-dim); margin-top:5px;">LIVE MARKET DATA</div>
            </div>
            
            <div class="tactical-toggle">
                <button id="btnPlanLong" class="side-btn" onclick="setManualSide('LONG')">LONG PLAN</button>
                <button id="btnPlanShort" class="side-btn" onclick="setManualSide('SHORT')">SHORT PLAN</button>
            </div>

            <div id="themeCard" class="theme-card">
                <div class="theme-lbl" id="themeTitle">WAITING FOR DATA</div>
                <div class="theme-val" id="triggerPrice">--</div>
                <div style="font-size:11px; margin-top:5px; color:var(--text-dim);" id="themeDesc">ENTRY TRIGGER</div>
            </div>

            <div class="target-grid">
                <div class="target-box"><div class="target-lbl">SHIELD</div><div class="target-val" id="tShield">--</div></div>
                <div class="target-box"><div class="target-lbl">TARGET 1</div><div class="target-val" id="t1">--</div></div>
                <div class="target-box"><div class="target-lbl">TARGET 2</div><div class="target-val" id="t2">--</div></div>
                <div class="target-box"><div class="target-lbl">TARGET 3</div><div class="target-val" id="t3">--</div></div>
            </div>
            
            <div class="kinetic-bar">
                <div>
                    <div style="font-size:10px; color:var(--text-dim); margin-bottom:4px;">KINETIC READINESS</div>
                    <div class="k-score" id="kScore">--</div>
                </div>
                <div style="text-align:right;">
                    <span id="kMode" class="k-mode">CALCULATING</span>
                    <div class="k-desc" id="kDesc" style="margin-top:4px;">Waiting...</div>
                </div>
            </div>
            
            <div class="brief-box">
                <div style="font-size:10px; font-weight:700; color:var(--text-dim); margin-bottom:5px;">TACTICAL BRIEF</div>
                <div class="brief-text" id="briefText">System initializing physics engine...</div>
            </div>
        </div>

        <div class="panel">
            <div class="panel-head">DATA STREAM</div>
            <div class="data-row"><span style="color:var(--text-dim)">CURRENT MODE</span><span id="txtMode" style="font-weight:700">--</span></div>
            <div class="data-row"><span style="color:var(--text-dim)">PLAN STOP LOSS</span><span id="txtStop" style="color:var(--red); font-weight:700">--</span></div>
            <br>
            <div class="panel-head" style="font-size:12px;">VERIFICATION</div>
            <div class="data-row"><span>R30 HIGH</span><span id="vRh" style="font-family:'JetBrains Mono'">--</span></div>
            <div class="data-row"><span>R30 LOW</span><span id="vRl" style="font-family:'JetBrains Mono'">--</span></div>
            <div class="data-row"><span>DAILY RES</span><span id="vDr" style="font-family:'JetBrains Mono'">--</span></div>
            <div class="data-row"><span>DAILY SUP</span><span id="vDs" style="font-family:'JetBrains Mono'">--</span></div>
            <div class="data-row" style="margin-top:10px;"><span>BREAKOUT (BO)</span><span id="vBo" style="font-family:'JetBrains Mono'; color:var(--green)">--</span></div>
            <div class="data-row"><span>BREAKDOWN (BD)</span><span id="vBd" style="font-family:'JetBrains Mono'; color:var(--red)">--</span></div>
        </div>
    </div>

    <script>
        let globalData = null;
        let manualOverrideSide = null;
        let ferrari = false;

        async function fetchLiveData() {
            const sess = document.getElementById('sessionSelect').value;
            try {
                const res = await fetch('/api/omega/status', {
                    method:'POST', headers:{'Content-Type':'application/json'},
                    body: JSON.stringify({ session_id: sess, ferrari_mode: ferrari })
                });
                globalData = await res.json();
                renderDisplay();
            } catch(e) { console.error(e); }
        }

        function toggleFerrari() {
            ferrari = !ferrari;
            const btn = document.getElementById('btnFerrari');
            if(ferrari) { btn.innerText = "FERRARI: ON"; btn.classList.add('active'); }
            else { btn.innerText = "FERRARI: OFF"; btn.classList.remove('active'); }
            fetchLiveData();
        }

        function setManualSide(side) { manualOverrideSide = side; renderDisplay(); }

        function copySize() {
            const txt = document.getElementById('outSize').innerText.replace(/,/g, '');
            navigator.clipboard.writeText(txt).then(() => {
                const btn = document.querySelector('.copy-btn');
                const orig = btn.innerText;
                btn.innerText = "COPIED";
                setTimeout(() => btn.innerText = orig, 1000);
            });
        }

        function renderDisplay() {
            if(!globalData || !globalData.price) return;

            document.getElementById('livePrice').innerText = globalData.price.toLocaleString(undefined, {minimumFractionDigits:2});
            const v = globalData.telemetry.verification;
            document.getElementById('vRh').innerText = v.r30_high.toFixed(2);
            document.getElementById('vRl').innerText = v.r30_low.toFixed(2);
            document.getElementById('vDr').innerText = v.daily_res.toFixed(2);
            document.getElementById('vDs').innerText = v.daily_sup.toFixed(2);
            document.getElementById('vBo').innerText = v.bo.toFixed(2);
            document.getElementById('vBd').innerText = v.bd.toFixed(2);

            let activeSide = manualOverrideSide || globalData.closest_side || "LONG";
            const btnL = document.getElementById('btnPlanLong');
            const btnS = document.getElementById('btnPlanShort');
            btnL.className = activeSide === "LONG" ? "side-btn active-long" : "side-btn";
            btnS.className = activeSide === "SHORT" ? "side-btn active-short" : "side-btn";

            const plan = globalData.plans[activeSide];
            const trigger = plan.trigger;
            const stop = plan.stop;
            const targets = plan.targets || [0,0,0,0];
            const sessionMode = globalData.session_mode;

            // --- CENTER CONSOLE LOGIC ---
            const card = document.getElementById('themeCard');
            const title = document.getElementById('themeTitle');
            const desc = document.getElementById('themeDesc');
            
            // Default Theme
            card.className = "theme-card";
            if (sessionMode === "SUPERSONIC") card.classList.add('mode-sonic');
            else if (sessionMode === "SNIPER") card.classList.add('mode-sniper');
            else card.classList.add('mode-dogfight');

            // STATUS OVERRIDE: Is the Trade Live?
            const status = globalData.status; // STANDBY, LOCKED, EXECUTING
            
            if (status === "EXECUTING") {
                // ACTIVE TRADE
                card.classList.add("exec-active"); // Special Flash Theme
                title.innerText = "MARKET EXECUTE // ACTIVE";
                desc.innerText = activeSide + " BREAKOUT CONFIRMED - DEPLOY";
                document.getElementById('triggerPrice').innerText = globalData.price.toLocaleString(undefined, {minimumFractionDigits:2}); // Show live price in box? Or Trigger? Keep Trigger for ref.
            } else if (status === "LOCKED") {
                // NEAR TRIGGER
                title.innerText = "TARGET LOCKED // PREPARING";
                desc.innerText = "PRICE NEAR " + activeSide + " TRIGGER";
                document.getElementById('triggerPrice').innerText = trigger.toLocaleString();
            } else {
                // STANDBY (PLANNING)
                title.innerText = activeSide + " ENTRY PLAN";
                desc.innerText = activeSide + " TRIGGER (" + sessionMode + " CONTEXT)";
                document.getElementById('triggerPrice').innerText = trigger.toLocaleString();
            }

            document.getElementById('txtMode').innerText = sessionMode;
            if (sessionMode === "SUPERSONIC") document.getElementById('txtMode').style.color = "var(--sonic-color)";
            else if (sessionMode === "SNIPER") document.getElementById('txtMode').style.color = "var(--sniper-color)";
            else document.getElementById('txtMode').style.color = "var(--dog-color)";

            document.getElementById('tShield').innerText = targets[0].toLocaleString();
            document.getElementById('t1').innerText = targets[1].toLocaleString();
            document.getElementById('t2').innerText = targets[2].toLocaleString();
            document.getElementById('t3').innerText = targets[3].toLocaleString();

            const bal = parseFloat(document.getElementById('inpBal').value) || 0;
            const riskPct = parseFloat(document.getElementById('inpRisk').value) || 0;
            const riskAmt = bal * (riskPct / 100);
            
            document.getElementById('valRiskAmt').innerText = "$" + riskAmt.toFixed(2) + " RISK";

            document.getElementById('txtStop').innerText = stop.toLocaleString();
            const riskPerShare = Math.abs(trigger - stop);
            if (riskPerShare > 0) {
                const size = (riskAmt / riskPerShare) * trigger; 
                document.getElementById('outSize').innerText = Math.floor(size).toLocaleString();
            } else {
                document.getElementById('outSize').innerText = "0";
            }

            if (globalData.kinetic) {
                const k = globalData.kinetic;
                document.getElementById('kScore').innerText = k.total_score + " / 100";
                
                const kMode = document.getElementById('kMode');
                kMode.innerText = k.protocol;
                kMode.className = "k-mode"; 
                
                if (k.color === "CYAN") kMode.classList.add('k-ferrari');
                else if (k.color === "GREEN") kMode.classList.add('k-sniper');
                else kMode.classList.add('k-dogfight');
                
                document.getElementById('kDesc').innerText = k.instruction;
                document.getElementById('briefText').innerText = k.brief;
            }
        }

        setInterval(fetchLiveData, 1000);
        fetchLiveData();
    </script>
</body>
</html>