<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>KABRODA // SYSTEM MONITOR</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700;800&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/site.css">
    <style>
        body { background: #020617; color: #fff; font-family: 'Inter', sans-serif; padding: 20px; }
        .nav-bar { display: flex; justify-content: space-between; border-bottom: 1px solid #1e293b; padding-bottom: 20px; margin-bottom: 30px; }
        .brand { font-family: 'JetBrains Mono'; font-weight: 800; color: #fff; font-size: 20px; }
        
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .card { background: #0f172a; border: 1px solid #1e293b; border-radius: 8px; padding: 20px; }
        .card-head { font-family: 'JetBrains Mono'; font-size: 12px; color: #94a3b8; font-weight: 700; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 1px; }
        
        /* LOGS */
        .log-table { width: 100%; border-collapse: collapse; font-size: 12px; font-family: 'JetBrains Mono'; }
        .log-table th { text-align: left; color: #64748b; padding: 8px; border-bottom: 1px solid #1e293b; }
        .log-table td { padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05); color: #cbd5e1; }
        .log-err { color: #ef4444; }
        .log-info { color: #10b981; }

        /* SIMULATOR */
        .sim-input { background: #020617; border: 1px solid #334155; color: #fff; padding: 10px; width: 100%; border-radius: 4px; font-family: 'JetBrains Mono'; margin-bottom: 10px; }
        .btn-run { background: #0ea5e9; color: #000; font-weight: 800; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; width: 100%; font-family: 'JetBrains Mono'; }
        .btn-run:hover { background: #38bdf8; }

        /* RESULTS */
        .result-box { margin-top: 15px; background: #020617; padding: 15px; border-radius: 4px; border: 1px solid #334155; min-height: 100px; }
        .res-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 13px; border-bottom: 1px solid #1e293b; padding-bottom: 4px; }
        .res-label { color: #94a3b8; }
        .res-val { font-family: 'JetBrains Mono'; font-weight: 700; }
    </style>
</head>
<body>

    <div class="nav-bar">
        <div class="brand">SYSTEM // MONITOR</div>
        <div>
            <a href="/suite" style="color: #94a3b8; text-decoration: none; font-weight: 700; font-size: 13px; margin-right: 20px;">BACK TO SUITE</a>
            <a href="/account" style="color: #94a3b8; text-decoration: none; font-weight: 700; font-size: 13px;">ACCOUNT</a>
        </div>
    </div>

    <div class="grid">
        <div class="card">
            <div class="card-head">Omega Stress Test (Simulator)</div>
            <p style="font-size: 13px; color: #64748b; margin-bottom: 20px;">
                Inject fake time and price data into the live engine to verify logic protocols. 
                Does not affect live users.
            </p>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <div>
                    <label style="font-size: 11px; color: #94a3b8; display: block; margin-bottom: 5px;">FORCE TIME (UTC HH:MM)</label>
                    <input type="text" id="simTime" class="sim-input" placeholder="e.g. 14:30">
                </div>
                <div>
                    <label style="font-size: 11px; color: #94a3b8; display: block; margin-bottom: 5px;">FORCE PRICE</label>
                    <input type="number" id="simPrice" class="sim-input" placeholder="e.g. 98500">
                </div>
            </div>
            
            <button onclick="runSimulation()" class="btn-run">RUN DIAGNOSTIC</button>

            <div class="result-box" id="simResult">
                <div style="text-align: center; color: #64748b; padding-top: 30px;">READY TO TEST</div>
            </div>
        </div>

        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <div class="card-head" style="margin-bottom: 0;">SYSTEM HEALTH LOGS</div>
                <button onclick="clearLogs()" style="background: transparent; border: 1px solid #334155; color: #64748b; font-size: 10px; padding: 4px 8px; cursor: pointer;">CLEAR ALL</button>
            </div>
            
            <div style="overflow-y: auto; max-height: 400px;">
                <table class="log-table">
                    <thead>
                        <tr>
                            <th>TIME</th>
                            <th>MODULE</th>
                            <th>MESSAGE</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for log in logs %}
                        <tr>
                            <td>{{ log.timestamp.strftime('%H:%M:%S') }}</td>
                            <td>{{ log.component }}</td>
                            <td class="{{ 'log-err' if log.level == 'ERROR' else 'log-info' }}">
                                {{ log.message }}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% if not logs %}
                    <div style="text-align: center; padding: 20px; color: #64748b; font-size: 12px;">No active logs. Systems nominal.</div>
                {% endif %}
            </div>
        </div>
    </div>

    <script>
        async function runSimulation() {
            const time = document.getElementById('simTime').value;
            const price = document.getElementById('simPrice').value;
            const resBox = document.getElementById('simResult');
            
            resBox.innerHTML = '<div style="text-align: center; color: #0ea5e9; padding-top: 30px;">CALCULATING...</div>';

            try {
                const res = await fetch('/api/omega/simulate', {
                    method: 'POST', headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ time: time, price: price })
                });
                const data = await res.json();
                
                if(data.ok) {
                    const k = data.kinetic;
                    const html = `
                        <div class="res-row"><span class="res-label">STATUS</span> <span class="res-val" style="color:${k.color}">${k.protocol}</span></div>
                        <div class="res-row"><span class="res-label">INSTRUCTION</span> <span class="res-val">${k.instruction}</span></div>
                        <div class="res-row"><span class="res-label">SCORE</span> <span class="res-val">${k.total_score}/100</span></div>
                        <div class="res-row"><span class="res-label">ACTIVE SIDE</span> <span class="res-val">${data.active_side}</span></div>
                        <div style="margin-top: 10px; font-size: 11px; color: #64748b;">${k.brief}</div>
                    `;
                    resBox.innerHTML = html;
                } else {
                    resBox.innerHTML = `<div style="color: #ef4444; padding-top: 30px; text-align: center;">ERROR: ${data.msg || data.error}</div>`;
                }
            } catch(e) {
                resBox.innerHTML = `<div style="color: #ef4444; padding-top: 30px; text-align: center;">CONNECTION FAILED</div>`;
            }
        }

        async function clearLogs() {
            if(!confirm("Clear all logs?")) return;
            await fetch('/api/system/log-clear', { method: 'POST' });
            window.location.reload();
        }
    </script>
</body>
</html>