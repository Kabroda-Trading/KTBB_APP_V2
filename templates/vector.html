<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Kabroda | Project Vector</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700;800&family=Rajdhani:wght@600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/site.css">
    <style>
        :root { --bg: #020617; --panel: #1e293b; --cyan: #22d3ee; --gold: #facc15; --red: #ef4444; --gray: #94a3b8; }
        body { background: var(--bg); color: #fff; font-family: 'JetBrains Mono'; padding: 20px; }
        
        /* LAYOUT */
        .vector-container { max-width: 1400px; margin: 0 auto; margin-top: 40px; display: grid; grid-template-columns: 320px 1fr 360px; gap: 20px; min-height: 800px; }
        .v-panel { background: var(--panel); border: 1px solid #334155; border-radius: 8px; padding: 25px; display: flex; flex-direction: column; }
        
        /* HEADER */
        .v-header { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 30px; border-bottom: 1px solid #334155; padding-bottom: 20px; }
        .v-title { font-family: 'Rajdhani'; font-size: 42px; font-weight: 800; color: #fff; margin: 0; line-height: 1; text-transform: uppercase; }
        
        /* HUD */
        .hud-display { text-align: center; flex-grow: 1; display: flex; flex-direction: column; justify-content: center; }
        .mode-text { font-family: 'Rajdhani'; font-size: 90px; font-weight: 900; line-height: 0.9; margin-bottom: 10px; text-transform: uppercase; }
        .advice-box { background: rgba(0,0,0,0.3); border: 1px solid #334155; padding: 15px; border-radius: 4px; color: #fff; margin-top: 20px; }

        /* GAUGES */
        .gauges-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: auto; padding-top: 20px; border-top: 1px solid #334155; }
        .gauge-box { background: #0f172a; padding: 10px; border-radius: 4px; }
        .g-lbl { font-size: 10px; color: var(--gray); font-weight: 700; text-transform: uppercase; }
        .g-val { font-size: 24px; font-weight: 800; font-family: 'Rajdhani'; }
        .g-track { height: 6px; background: #334155; margin-top: 5px; border-radius: 3px; overflow: hidden; }
        .g-fill { height: 100%; width: 0%; transition: width 0.5s ease; }

        /* INPUTS & DATA */
        .inp-dark { background: #020617; border: 1px solid #475569; color: #fff; padding: 10px; width: 100%; text-align: right; font-weight: 700; margin-bottom: 15px; }
        .data-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px dashed #334155; font-size: 13px; }
        
        .c-CYAN { color: var(--cyan); text-shadow: 0 0 30px rgba(34,211,238,0.2); }
        .c-GOLD { color: var(--gold); text-shadow: 0 0 30px rgba(250,204,21,0.2); }
        .c-RED { color: var(--red); opacity: 0.8; }
    </style>
</head>
<body>
    {% include 'nav.html' %}
    
    <div class="vector-container">
        <div class="v-panel">
            <div style="font-size:12px; color:#94a3b8; font-weight:700; margin-bottom:10px;">TARGET ASSET</div>
            <select id="selAsset" class="inp-dark" onchange="runVector()">
                <option value="BTCUSDT">BTC (BITCOIN)</option>
                <option value="ETHUSDT">ETH (ETHEREUM)</option>
                <option value="SOLUSDT">SOL (SOLANA)</option>
            </select>
            
            <div style="margin-top:20px; padding-top:20px; border-top:1px dashed #334155;">
                <div style="font-size:12px; color:#94a3b8; margin-bottom:5px;">LIVE PRICE</div>
                <div id="vPrice" style="font-size:36px; font-weight:800; font-family:'Rajdhani';">--</div>
            </div>

            <div style="margin-top:auto;">
                <div style="font-size:12px; color:#94a3b8;">KINETIC SCORE</div>
                <div id="vScore" style="font-size:64px; font-weight:900; font-family:'Rajdhani'; color:#fff;">--</div>
            </div>
        </div>

        <div class="v-panel" style="background: #0b1121;">
            <div class="hud-display">
                <div style="font-size:14px; color:#94a3b8; letter-spacing:2px; font-weight:700;">VECTOR STATUS</div>
                <div id="vMode" class="mode-text c-RED">CALIBRATING</div>
                <div id="vAdvice" class="advice-box">INITIALIZING...</div>
            </div>

            <div class="gauges-grid">
                <div class="gauge-box"><div class="g-lbl">ENERGY</div><div id="vEnergy" class="g-val">--</div><div class="g-track"><div id="bEnergy" class="g-fill"></div></div></div>
                <div class="gauge-box"><div class="g-lbl">SPACE</div><div id="vSpace" class="g-val">--</div><div class="g-track"><div id="bSpace" class="g-fill"></div></div></div>
                <div class="gauge-box"><div class="g-lbl">WIND</div><div id="vWind" class="g-val">--</div><div class="g-track"><div id="bWind" class="g-fill"></div></div></div>
                <div class="gauge-box"><div class="g-lbl">HULL</div><div id="vHull" class="g-val">--</div><div class="g-track"><div id="bHull" class="g-fill"></div></div></div>
            </div>
        </div>

        <div class="v-panel">
            <div style="font-size:12px; color:#22d3ee; font-weight:700; margin-bottom:15px; text-transform:uppercase;">FLIGHT PLAN</div>
            
            <div class="data-row"><span>ENTRY</span><span id="pEntry" style="color:#22d3ee; font-weight:700;">--</span></div>
            <div class="data-row"><span>STOP</span><span id="pStop" style="color:#ef4444; font-weight:700;">--</span></div>
            
            <div style="height:20px;"></div>
            <div class="data-row"><span style="color:#facc15;">TARGET 1</span><span id="pT1">--</span></div>
            <div class="data-row"><span>TARGET 2</span><span id="pT2">--</span></div>
            <div class="data-row"><span>TARGET 3</span><span id="pT3">--</span></div>

            <input type="hidden" id="missionKey">
            <button onclick="copyKey()" style="margin-top:auto; background:#facc15; color:#000; border:none; padding:15px; font-weight:800; cursor:pointer; font-family:'JetBrains Mono';">COPY MISSION KEY</button>
        </div>
    </div>

    <script>
        async function runVector() {
            const sym = document.getElementById('selAsset').value;
            // CALL THE VECTOR API (v4.2)
            const res = await fetch('/api/vector/intel', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ symbol: sym }) });
            const data = await res.json();
            if(!data.ok) return;

            const v = data.vector; const m = data.metrics; const p = data.plan;

            // Header
            document.getElementById('vPrice').innerText = data.price.toLocaleString();
            document.getElementById('vScore').innerText = v.score;
            document.getElementById('vScore').style.color = (v.score >= 50) ? '#fff' : '#ef4444';

            // Mode
            const modeEl = document.getElementById('vMode');
            modeEl.innerText = v.mode;
            modeEl.className = `mode-text c-${v.color}`;
            document.getElementById('vAdvice').innerText = v.advice;
            document.getElementById('vAdvice').style.borderColor = (v.color === 'GOLD') ? '#facc15' : ((v.color === 'CYAN') ? '#22d3ee' : '#334155');

            // Gauges
            const drawG = (id, obj) => {
                document.getElementById(id).innerText = Math.round(obj.val);
                document.getElementById('b'+id.substring(1)).style.width = obj.pct + "%";
                document.getElementById('b'+id.substring(1)).style.background = (obj.color === 'CYAN') ? '#22d3ee' : ((obj.color === 'GOLD') ? '#facc15' : ((obj.color === 'GREEN') ? '#10b981' : '#ef4444'));
            };
            drawG('vEnergy', m.energy);
            drawG('vSpace', m.space);
            drawG('vWind', m.wind);
            drawG('vHull', m.hull);

            // Plan
            if(p.valid) {
                document.getElementById('pEntry').innerText = p.entry.toLocaleString();
                document.getElementById('pStop').innerText = p.stop.toLocaleString();
                document.getElementById('pT1').innerText = p.targets[0].toLocaleString();
                document.getElementById('pT2').innerText = p.targets[1].toLocaleString();
                document.getElementById('pT3').innerText = p.targets[2].toLocaleString();
            } else {
                document.getElementById('pEntry').innerText = "BLOCKED";
                document.getElementById('pStop').innerText = "--";
            }
            document.getElementById('missionKey').value = data.mission_key;
        }

        function copyKey() { navigator.clipboard.writeText(document.getElementById('missionKey').value); alert("Key Copied"); }
        runVector(); setInterval(runVector, 5000);
    </script>
</body>
</html>