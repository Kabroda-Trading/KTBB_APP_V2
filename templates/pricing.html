{% extends "base.html" %}
{% block content %}

<div class="text-center" style="margin-bottom: 60px;">
  <h1 class="display-title">Operational <span class="gradient-text">Superiority</span></h1>
  <p class="lead-text">One tier. Total access. Everything you need to trade structure instead of feelings.</p>
</div>

<div class="row" style="justify-content: center; margin-bottom: 80px;">
  
  <div class="bento-card" style="max-width: 500px; width: 100%; border-color: var(--primary); box-shadow: 0 0 40px rgba(14, 165, 233, 0.15);">
    <div style="text-align: center; margin-bottom: 30px; border-bottom: 1px solid var(--glass-border); padding-bottom: 30px;">
      <h2 style="margin-bottom: 10px;">BattleBox Access</h2>
      <div style="font-size: 64px; font-weight: 900; color: #fff; line-height: 1;">
        $79<span style="font-size: 20px; color: var(--text-muted); font-weight: 500;">/mo</span>
      </div>
      <p style="color: var(--primary-bright); font-weight: 600; margin-top: 16px;">Full Commercial License</p>
    </div>

    <ul style="list-style: none; padding: 0; margin-bottom: 40px;">
      <li style="margin-bottom: 20px; display: flex; gap: 16px; align-items: center;">
        <span style="color: var(--primary-bright); font-size: 20px;">‚ö°</span>
        <span><strong>Institutional Data Feed</strong> (Spot & Futures Sync)</span>
      </li>
      <li style="margin-bottom: 20px; display: flex; gap: 16px; align-items: center;">
        <span style="color: var(--primary-bright); font-size: 20px;">üß†</span>
        <span><strong>BattleBox GPT Link</strong> (Desk-Grade Analysis)</span>
      </li>
      <li style="margin-bottom: 20px; display: flex; gap: 16px; align-items: center;">
        <span style="color: var(--primary-bright); font-size: 20px;">üìä</span>
        <span><strong>Full Indicator Suite</strong> (TradingView Scripts)</span>
      </li>
      <li style="margin-bottom: 20px; display: flex; gap: 16px; align-items: center;">
        <span style="color: var(--primary-bright); font-size: 20px;">üõ°Ô∏è</span>
        <span><strong>Execution Guardrails</strong> (Daily S/R + Triggers)</span>
      </li>
    </ul>

    <button class="btn primary" style="width: 100%; font-size: 16px;" onclick="startPlan()">Deploy System</button>
    <p class="text-center" style="font-size: 12px; margin-top: 16px; color: var(--text-muted);">Secure Stripe Processing. Cancel Anytime.</p>
  </div>

</div>

<script>
async function startPlan(){
  // Check if user is logged in (we can infer this if the server sends a specific header, or just try the checkout)
  const btn = document.querySelector('button');
  const originalText = btn.innerText;
  btn.innerText = "Initializing...";
  
  try {
    const r = await fetch("/billing/checkout", {
      method:"POST", 
      headers: {"Content-Type":"application/json"}, 
      body: JSON.stringify({})
    });

    if (r.status === 401) {
      // USER IS NOT LOGGED IN.
      // Redirect to REGISTER, not Login, because they are likely new.
      // We add ?next=checkout to tell the register page to forward them later (if we built that logic),
      // but for now, just getting them to register is the priority.
      window.location.href = "/register"; 
      return; 
    }

    const data = await r.json();
    if(data.url) {
      window.location.href = data.url;
    } else {
      alert("Error initializing checkout. Please contact support.");
      btn.innerText = originalText;
    }
  } catch (e) {
    // If fetch fails entirely
    window.location.href = "/register";
  }
}
</script>
{% endblock %}