{% extends "base.html" %}
{% block content %}

<div class="text-center" style="margin-bottom: 50px;">
  <div class="pill">OPERATIONAL ACCESS</div>
  <h1 class="display-title">Choose Your <span class="gradient-text">Commitment</span></h1>
  <p class="lead-text">
    All plans include the <strong>7-Day Free Trial</strong>. Zero risk. Cancel anytime.
  </p>
</div>

<div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 24px; max-width: 1200px; margin: 0 auto;">

  <div class="bento-card" style="flex: 1; min-width: 300px; border-top: 4px solid var(--text-muted); display: flex; flex-direction: column;">
    <div style="margin-bottom: 20px;">
      <h3 style="color: var(--text-muted); font-size: 14px; text-transform: uppercase; letter-spacing: 0.1em;">Standard</h3>
      <div style="font-size: 42px; font-weight: 900; color: #fff; margin-top: 10px;">$89<span style="font-size: 16px; color: var(--text-muted); font-weight: 500;">/mo</span></div>
      <p style="font-size: 14px; color: var(--text-muted);">Total flexibility. Month to month.</p>
    </div>
    <div style="flex: 1;">
      <ul style="list-style: none; padding: 0; line-height: 2; font-size: 14px; color: #e2e8f0;">
        <li>✅ Full Institutional Data Feed</li>
        <li>✅ 30m Execution Anchor</li>
        <li>✅ BattleBox AI Command</li>
      </ul>
    </div>
    <button onclick="startPlan('monthly')" class="btn secondary" style="width: 100%; margin-top: 24px;">Start Monthly Trial</button>
  </div>

  <div class="bento-card" style="flex: 1; min-width: 300px; border: 2px solid var(--primary); background: linear-gradient(180deg, rgba(14,165,233,0.1) 0%, rgba(0,0,0,0) 100%); transform: scale(1.05); z-index: 10; display: flex; flex-direction: column;">
    <div style="position: absolute; top: 0; right: 0; background: var(--primary); color: #000; font-size: 10px; font-weight: 800; padding: 4px 12px; border-bottom-left-radius: 8px;">BEST VALUE</div>
    <div style="margin-bottom: 20px;">
      <h3 style="color: var(--primary-bright); font-size: 14px; text-transform: uppercase; letter-spacing: 0.1em;">Annual</h3>
      <div style="font-size: 42px; font-weight: 900; color: #fff; margin-top: 10px;">$890<span style="font-size: 16px; color: var(--text-muted); font-weight: 500;">/yr</span></div>
      <div style="font-size: 13px; color: var(--success); font-weight: 700; margin-top: 4px;">SAVE $178 (2 MONTHS FREE)</div>
    </div>
    <div style="flex: 1;">
      <ul style="list-style: none; padding: 0; line-height: 2; font-size: 14px; color: #fff;">
        <li>✅ <strong>Everything in Standard</strong></li>
        <li>✅ Priority Support Access</li>
        <li>✅ Locked-in Rate for 12 Months</li>
      </ul>
    </div>
    <button onclick="startPlan('annual')" class="btn primary" style="width: 100%; margin-top: 24px;">Start Annual Trial</button>
  </div>

  <div class="bento-card" style="flex: 1; min-width: 300px; border-top: 4px solid var(--success); display: flex; flex-direction: column;">
    <div style="margin-bottom: 20px;">
      <h3 style="color: var(--success); font-size: 14px; text-transform: uppercase; letter-spacing: 0.1em;">Semi-Annual</h3>
      <div style="font-size: 42px; font-weight: 900; color: #fff; margin-top: 10px;">$499<span style="font-size: 16px; color: var(--text-muted); font-weight: 500;">/6mo</span></div>
      <div style="font-size: 13px; color: var(--text-muted); margin-top: 4px;">Save ~$35 vs Monthly</div>
    </div>
    <div style="flex: 1;">
      <ul style="list-style: none; padding: 0; line-height: 2; font-size: 14px; color: #e2e8f0;">
        <li>✅ Full Institutional Data Feed</li>
        <li>✅ 30m Execution Anchor</li>
        <li>✅ BattleBox AI Command</li>
      </ul>
    </div>
    <button onclick="startPlan('semi')" class="btn secondary" style="width: 100%; margin-top: 24px;">Start 6-Month Trial</button>
  </div>

</div>

<script>
async function startPlan(planKey){
  const btns = document.querySelectorAll('button');
  btns.forEach(b => b.disabled = true); // Prevent double click

  try {
    const r = await fetch("/billing/checkout", {
      method:"POST", 
      headers: {"Content-Type":"application/json"}, 
      body: JSON.stringify({ plan: planKey }) // SEND PLAN KEY
    });

    if (r.status === 401) {
      window.location.href = "/register"; 
      return; 
    }

    const data = await r.json();
    if(data.url) {
      window.location.href = data.url;
    } else {
      alert("System Error: Could not initiate checkout.");
      btns.forEach(b => b.disabled = false);
    }
  } catch (e) {
    window.location.href = "/register";
  }
}
</script>
{% endblock %}