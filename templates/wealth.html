{% extends "base.html" %}
{% block content %}

<div class="text-center" style="margin-bottom: 40px;">
  <div class="pill">KABRODA WEALTH ENGINE</div>
  <h1 class="display-title">Long Term <span class="gradient-text">Structure</span></h1>
  <p class="lead-text">
    Trading generates cash flow. Structure generates wealth. <br>
    Align your capital with the macro cycle.
  </p>
</div>

<div class="bento-grid">

  <div class="bento-card wide" style="border-left: 4px solid var(--success); display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 20px;">
    <div>
      <h3 style="font-size: 14px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 8px;">MACRO CYCLE STATUS</h3>
      <div id="macro-phase" style="font-size: 32px; font-weight: 900; color: #fff;">CALCULATING...</div>
      <div id="macro-detail" style="font-size: 13px; color: var(--success); margin-top: 4px;">--</div>
    </div>
    <div style="text-align: right;">
      <div style="font-size: 11px; color: var(--text-muted);">BTC/USD REFERENCE</div>
      <div id="macro-price" style="font-size: 24px; font-weight: 700; color: #fff; font-family: monospace;">$--,---</div>
    </div>
  </div>

  <div class="bento-card">
    <h3 style="margin-bottom: 20px;">Capital Injection</h3>
    <div style="margin-bottom: 16px;">
      <label class="label">Available Capital (USD)</label>
      <input type="number" id="capitalInput" class="input" placeholder="10000" value="10000">
    </div>
    
    <div style="margin-bottom: 24px;">
      <label class="label">Strategy Profile</label>
      <select id="profileSelect" class="input">
        <option value="vault">üõ°Ô∏è Vault (Spot Hold)</option>
        <option value="growth">üìà Growth (DCA Strategy)</option>
        <option value="alpha">üöÄ Alpha (Cycle Trading)</option>
      </select>
    </div>

    <button onclick="runSimulation()" class="btn primary" style="width: 100%;">RUN SIMULATION</button>
  </div>

  <div class="bento-card" style="border: 1px dashed var(--glass-border);">
    <h3 style="margin-bottom: 20px; color: var(--text-muted);">Cycle Projection (4 Year)</h3>
    
    <div style="margin-bottom: 16px;">
      <div class="label">PROJECTED VALUE</div>
      <div id="res-total" style="font-size: 36px; font-weight: 900; color: #fff;">$0</div>
    </div>

    <div style="display: flex; gap: 20px;">
      <div>
        <div class="label">NET PROFIT</div>
        <div id="res-profit" style="font-size: 18px; color: var(--success); font-weight: 700;">$0</div>
      </div>
      <div>
        <div class="label">MULTIPLIER</div>
        <div id="res-mult" style="font-size: 18px; color: var(--primary-bright); font-weight: 700;">0x</div>
      </div>
    </div>
    
    <p style="font-size: 11px; color: var(--text-muted); margin-top: 24px; line-height: 1.4;">
      *Projections based on historical Bitcoin cycle halving data. Not financial advice. Past performance does not guarantee future results.
    </p>
  </div>

</div>

<script>
  async function loadMacro() {
    try {
      const r = await fetch("/api/wealth/macro");
      const d = await r.json();
      
      document.getElementById("macro-phase").innerText = d.phase.replace("_", " ");
      document.getElementById("macro-price").innerText = "$" + d.current_price.toLocaleString();
      
      const dist = d.distance_to_200;
      const msg = dist > 0 ? `+${dist}% Above 200 DMA` : `${dist}% Below 200 DMA`;
      document.getElementById("macro-detail").innerText = msg;
      
      // Color logic
      const el = document.getElementById("macro-phase");
      if(d.phase.includes("BEAR")) el.style.color = "var(--danger)";
      else if(d.phase.includes("ACCUMULATION")) el.style.color = "var(--warning)";
      else el.style.color = "var(--success)";
      
    } catch(e) {
      console.log(e);
    }
  }

  async function runSimulation() {
    const cap = document.getElementById("capitalInput").value;
    const prof = document.getElementById("profileSelect").value;
    
    const r = await fetch("/api/wealth/calc", {
      method: "POST", headers:{"Content-Type":"application/json"},
      body: JSON.stringify({ capital: cap, profile: prof })
    });
    const d = await r.json();
    
    document.getElementById("res-total").innerText = "$" + d.projected_value.toLocaleString(undefined, {maximumFractionDigits:0});
    document.getElementById("res-profit").innerText = "+$" + d.profit.toLocaleString(undefined, {maximumFractionDigits:0});
    document.getElementById("res-mult").innerText = d.multiplier + "x";
  }

  document.addEventListener("DOMContentLoaded", loadMacro);
</script>
{% endblock %}